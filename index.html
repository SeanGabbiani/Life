<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Life – Conway’s Game of Life</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA bits (keep these for your icon + “app” behaviour) -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#000000" />

  <style>
    :root {
      --bg: #050608;
      --toolbar-bg: #111319;
      --button-bg: #1b1e27;
      --button-border: #2a2e3a;
      --button-text: #f5f5f5;
      --accent: #27e8a7;
      --grid-dead: #050608;
      --grid-alive: #27e8a7;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      background: var(--bg);
      color: var(--button-text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      overflow: hidden;
    }

    #app {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }

    #toolbar {
      background: var(--toolbar-bg);
      padding: 8px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 1px 0 rgba(255, 255, 255, 0.03);
      z-index: 10;
    }

    .btn {
      border-radius: 14px;
      border: 1px solid var(--button-border);
      background: var(--button-bg);
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
      white-space: nowrap;
    }

    .btn.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(39, 232, 167, 0.3);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .spacer {
      flex: 1;
    }

    .slider-group {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .slider-group label {
      font-size: 12px;
      opacity: 0.7;
    }

    .slider-group input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 140px;
      height: 4px;
      border-radius: 999px;
      background: #232735;
      outline: none;
    }

    .slider-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      border: none;
    }

    #grid-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    #grid {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      touch-action: none;
      background: var(--grid-dead);
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="toolbar">
      <button class="btn" id="paintBtn">Paint</button>
      <button class="btn" id="eraseBtn">Erase</button>
      <button class="btn" id="randomBtn">Random</button>
      <button class="btn" id="clearBtn">Clear</button>
      <button class="btn" id="bestiaryBtn">Bestiary</button>

      <div class="spacer"></div>

      <div class="slider-group">
        <label for="speedSlider">Speed</label>
        <input id="speedSlider" type="range" min="50" max="800" value="200" />
      </div>

      <div class="slider-group">
        <label for="cellSlider">Cell</label>
        <input id="cellSlider" type="range" min="6" max="24" value="12" />
      </div>
    </div>

    <div id="grid-container">
      <canvas id="grid"></canvas>
    </div>
  </div>

  <script>
    // Simple, self-contained Game of Life implementation

    const canvas = document.getElementById("grid");
    const ctx = canvas.getContext("2d");

    const paintBtn = document.getElementById("paintBtn");
    const eraseBtn = document.getElementById("eraseBtn");
    const randomBtn = document.getElementById("randomBtn");
    const clearBtn = document.getElementById("clearBtn");
    const bestiaryBtn = document.getElementById("bestiaryBtn");

    const speedSlider = document.getElementById("speedSlider");
    const cellSlider = document.getElementById("cellSlider");

    let cellSize = parseInt(cellSlider.value, 10);
    let rows = 0;
    let cols = 0;
    let grid = [];
    let running = false;
    let frameId = null;
    let paintMode = "paint"; // or "erase"
    let pointerDown = false;

    function resizeGrid() {
      const container = document.getElementById("grid-container");
      const w = container.clientWidth || window.innerWidth;
      const h = container.clientHeight || (window.innerHeight - 70);

      canvas.width = w;
      canvas.height = h;

      cols = Math.floor(w / cellSize);
      rows = Math.floor(h / cellSize);

      grid = createEmptyGrid(rows, cols);
      drawGrid();
    }

    function createEmptyGrid(r, c) {
      const g = [];
      for (let y = 0; y < r; y++) {
        const row = new Array(c).fill(0);
        g.push(row);
      }
      return g;
    }

    function drawGrid() {
      ctx.fillStyle = getComputedStyle(document.documentElement)
        .getPropertyValue("--grid-dead") || "#050608";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const aliveColor = getComputedStyle(document.documentElement)
        .getPropertyValue("--grid-alive") || "#27e8a7";

      ctx.fillStyle = aliveColor;
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          if (grid[y][x]) {
            ctx.fillRect(
              x * cellSize,
              y * cellSize,
              cellSize - 1,
              cellSize - 1
            );
          }
        }
      }
    }

    function step() {
      const next = createEmptyGrid(rows, cols);

      const get = (y, x) => {
        if (x < 0 || x >= cols || y < 0 || y >= rows) return 0;
        return grid[y][x];
      };

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          let n =
            get(y - 1, x - 1) +
            get(y - 1, x) +
            get(y - 1, x + 1) +
            get(y, x - 1) +
            get(y, x + 1) +
            get(y + 1, x - 1) +
            get(y + 1, x) +
            get(y + 1, x + 1);

          if (grid[y][x]) {
            next[y][x] = n === 2 || n === 3 ? 1 : 0;
          } else {
            next[y][x] = n === 3 ? 1 : 0;
          }
        }
      }

      grid = next;
      drawGrid();
    }

    function loop() {
      if (!running) return;
      step();
      const delay = parseInt(speedSlider.value, 10);
      frameId = setTimeout(() => requestAnimationFrame(loop), delay);
    }

    function start() {
      if (running) return;
      running = true;
      loop();
    }

    function stop() {
      running = false;
      if (frameId) {
        clearTimeout(frameId);
        frameId = null;
      }
    }

    function randomFill() {
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          grid[y][x] = Math.random() < 0.2 ? 1 : 0;
        }
      }
      drawGrid();
    }

    function clearGrid() {
      grid = createEmptyGrid(rows, cols);
      drawGrid();
    }

    function togglePaintMode(mode) {
      paintMode = mode;
      paintBtn.classList.toggle("active", mode === "paint");
      eraseBtn.classList.toggle("active", mode === "erase");
    }

    function pointerPos(evt) {
      const rect = canvas.getBoundingClientRect();
      const x = evt.clientX - rect.left;
      const y = evt.clientY - rect.top;
      const cx = Math.floor(x / cellSize);
      const cy = Math.floor(y / cellSize);
      if (cx < 0 || cx >= cols || cy < 0 || cy >= rows) return null;
      return { cx, cy };
    }

    function applyPaint(evt) {
      const p = pointerPos(evt);
      if (!p) return;
      grid[p.cy][p.cx] = paintMode === "paint" ? 1 : 0;
      drawGrid();
    }

    // Pointer events
    canvas.addEventListener("pointerdown", (evt) => {
      pointerDown = true;
      applyPaint(evt);
    });

    canvas.addEventListener("pointermove", (evt) => {
      if (!pointerDown) return;
      applyPaint(evt);
    });

    window.addEventListener("pointerup", () => {
      pointerDown = false;
    });

    window.addEventListener("pointercancel", () => {
      pointerDown = false;
    });

    // Toolbar
    paintBtn.addEventListener("click", () => togglePaintMode("paint"));
    eraseBtn.addEventListener("click", () => togglePaintMode("erase"));
    randomBtn.addEventListener("click", () => randomFill());
    clearBtn.addEventListener("click", () => clearGrid());

    // For now Bestiary just pauses / resumes
    bestiaryBtn.addEventListener("click", () => {
      if (running) {
        stop();
        bestiaryBtn.textContent = "Run";
      } else {
        start();
        bestiaryBtn.textContent = "Pause";
      }
    });

    // Cell size slider
    cellSlider.addEventListener("input", () => {
      cellSize = parseInt(cellSlider.value, 10);
      resizeGrid();
    });

    window.addEventListener("resize", () => {
      resizeGrid();
    });

    // Initial setup
    window.addEventListener("load", () => {
      togglePaintMode("paint");
      resizeGrid();
      drawGrid();
    });
  </script>
</body>
</html>
